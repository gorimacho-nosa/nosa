<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>async/await - ã•ã‚‰ã«ç›´æ„Ÿçš„ãªéåŒæœŸå‡¦ç†</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="async-styles.css">
</head>
<body>
    <header>
        <div style="text-align: right; padding: 10px;">
            <a href="promise.html" style="color: white; text-decoration: none; font-size: 16px; background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 8px; transition: background 0.3s;">â† Promiseã‚¬ã‚¤ãƒ‰</a>
        </div>
        <h1>async/await<br>å®Œå…¨ç†è§£ã‚¬ã‚¤ãƒ‰</h1>
        <p class="subtitle">åŒæœŸçš„ã«æ›¸ã‘ã‚‹éåŒæœŸå‡¦ç† - Promiseã‚’ã•ã‚‰ã«ä½¿ã„ã‚„ã™ã</p>
    </header>

    <nav>
        <ul>
            <li><a href="#what-is-async-await">async/awaitã¨ã¯ï¼Ÿ</a></li>
            <li><a href="#basic-syntax">åŸºæœ¬çš„ãªæ§‹æ–‡</a></li>
            <li><a href="#error-handling">ã‚¨ãƒ©ãƒ¼å‡¦ç†</a></li>
            <li><a href="#parallel-processing">ä¸¦åˆ—å‡¦ç†</a></li>
            <li><a href="#practical-examples">å®Ÿè·µçš„ãªä¾‹</a></li>
            <li><a href="#best-practices">ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</a></li>
        </ul>
    </nav>

    <main>
        <section id="what-is-async-await">
            <h2>async/awaitã¨ã¯ï¼Ÿ</h2>
            <div class="explanation">
                <p>async/awaitã¯<strong>Promiseã‚’ã‚ˆã‚Šç›´æ„Ÿçš„ã«æ‰±ã†ãŸã‚ã®æ§‹æ–‡ç³–è¡£ï¼ˆã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚·ãƒ¥ã‚¬ãƒ¼ï¼‰</strong>ã§ã™ã€‚</p>
                <p>éåŒæœŸå‡¦ç†ã‚’åŒæœŸå‡¦ç†ã®ã‚ˆã†ã«æ›¸ã‘ã‚‹ãŸã‚ã€ã‚³ãƒ¼ãƒ‰ãŒã‚ˆã‚Šèª­ã¿ã‚„ã™ããªã‚Šã¾ã™ã€‚</p>
                
                <div class="analogy">
                    <h3>ğŸ³ æ—¥å¸¸ç”Ÿæ´»ã§ã®ä¾‹ãˆ</h3>
                    <p>æ–™ç†ã®ãƒ¬ã‚·ãƒ”ã‚’æ›¸ãã¨ãã®é•ã„ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ï¼</p>
                    <div class="recipe-comparison">
                        <div class="promise-recipe">
                            <h4>Promiseã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆè¤‡é›‘ï¼‰</h4>
                            <ol>
                                <li>é‡èœã‚’åˆ‡ã‚‹.then(() =></li>
                                <li>&nbsp;&nbsp;ãƒ•ãƒ©ã‚¤ãƒ‘ãƒ³ã‚’æ¸©ã‚ã‚‹).then(() =></li>
                                <li>&nbsp;&nbsp;&nbsp;&nbsp;ç‚’ã‚ã‚‹).then(() =></li>
                                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å®Œæˆï¼)</li>
                            </ol>
                        </div>
                        <div class="async-recipe">
                            <h4>async/awaitã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰</h4>
                            <ol>
                                <li>é‡èœã‚’åˆ‡ã‚‹</li>
                                <li>ãƒ•ãƒ©ã‚¤ãƒ‘ãƒ³ã‚’æ¸©ã‚ã‚‹</li>
                                <li>ç‚’ã‚ã‚‹</li>
                                <li>å®Œæˆï¼</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <h3>Promiseã¨async/awaitã®æ¯”è¼ƒ</h3>
                <div class="code-comparison">
                    <div class="promise-code">
                        <h4>Promiseãƒã‚§ãƒ¼ãƒ³</h4>
                        <pre><code>function fetchUserData() {
    return fetch('/api/user')
        .then(response => response.json())
        .then(user => {
            return fetch(`/api/posts/${user.id}`);
        })
        .then(response => response.json())
        .then(posts => {
            console.log(posts);
        })
        .catch(error => {
            console.error(error);
        });
}</code></pre>
                    </div>
                    <div class="async-code">
                        <h4>async/await</h4>
                        <pre><code>async function fetchUserData() {
    try {
        const userResponse = await fetch('/api/user');
        const user = await userResponse.json();
        
        const postsResponse = await fetch(`/api/posts/${user.id}`);
        const posts = await postsResponse.json();
        
        console.log(posts);
    } catch (error) {
        console.error(error);
    }
}</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <section id="basic-syntax">
            <h2>åŸºæœ¬çš„ãªæ§‹æ–‡</h2>
            
            <div class="syntax-rules">
                <div class="rule">
                    <h3>1. asyncé–¢æ•°ã®å®šç¾©</h3>
                    <p>é–¢æ•°ã®å‰ã«<code>async</code>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä»˜ã‘ã‚‹</p>
                    <pre><code>// é–¢æ•°å®£è¨€
async function myFunction() {
    // ...
}

// é–¢æ•°å¼
const myFunction = async () => {
    // ...
}

// ãƒ¡ã‚½ãƒƒãƒ‰
class MyClass {
    async myMethod() {
        // ...
    }
}</code></pre>
                </div>

                <div class="rule">
                    <h3>2. awaitã®ä½¿ç”¨</h3>
                    <p>Promiseã®å‰ã«<code>await</code>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä»˜ã‘ã‚‹</p>
                    <pre><code>async function example() {
    // awaitã¯asyncé–¢æ•°å†…ã§ã®ã¿ä½¿ç”¨å¯èƒ½
    const result = await somePromise();
    console.log(result);
}</code></pre>
                </div>
            </div>

            <div class="example">
                <h3>åŸºæœ¬çš„ãªä¾‹</h3>
                <pre><code>// é…å»¶ã‚’ä½œã‚‹é–¢æ•°
function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

// async/awaitã‚’ä½¿ã£ãŸé–¢æ•°
async function greetWithDelay() {
    console.log('ã“ã‚“ã«ã¡ã¯ï¼');
    
    await delay(2000); // 2ç§’å¾…ã¤
    console.log('2ç§’çµŒã¡ã¾ã—ãŸ');
    
    await delay(1000); // 1ç§’å¾…ã¤
    console.log('ã•ã‚‰ã«1ç§’çµŒã¡ã¾ã—ãŸ');
    
    return 'æŒ¨æ‹¶å®Œäº†ï¼';
}

// å®Ÿè¡Œ
greetWithDelay().then(result => {
    console.log(result);
});</code></pre>
                <button class="run-code" onclick="runAsyncExample1()">å®Ÿè¡Œã—ã¦ã¿ã‚‹</button>
                <div class="output" id="async-output-1"></div>
            </div>
        </section>

        <section id="error-handling">
            <h2>ã‚¨ãƒ©ãƒ¼å‡¦ç†</h2>
            
            <div class="example">
                <h3>try-catchã‚’ä½¿ã£ãŸã‚¨ãƒ©ãƒ¼å‡¦ç†</h3>
                <pre><code>async function fetchDataWithErrorHandling() {
    try {
        // æˆåŠŸã™ã‚‹å‡¦ç†
        const data1 = await Promise.resolve('ãƒ‡ãƒ¼ã‚¿1å–å¾—æˆåŠŸ');
        console.log(data1);
        
        // å¤±æ•—ã™ã‚‹å‡¦ç†
        const data2 = await Promise.reject(new Error('ãƒ‡ãƒ¼ã‚¿2å–å¾—å¤±æ•—'));
        console.log(data2); // ã“ã“ã¯å®Ÿè¡Œã•ã‚Œãªã„
        
    } catch (error) {
        console.error('ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒ:', error.message);
    } finally {
        console.log('å‡¦ç†çµ‚äº†');
    }
}

fetchDataWithErrorHandling();</code></pre>
                <button class="run-code" onclick="runErrorHandlingExample()">å®Ÿè¡Œã—ã¦ã¿ã‚‹</button>
                <div class="output" id="error-output"></div>
            </div>

            <div class="example">
                <h3>è¤‡æ•°ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</h3>
                <pre><code>async function robustFetch(url) {
    const maxRetries = 3;
    
    for (let i = 0; i < maxRetries; i++) {
        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return await response.json();
            
        } catch (error) {
            console.log(`è©¦è¡Œ ${i + 1} å¤±æ•—:`, error.message);
            
            if (i === maxRetries - 1) {
                throw error; // æœ€å¾Œã®è©¦è¡Œã§ã‚‚å¤±æ•—ã—ãŸã‚‰ã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ã‚‹
            }
            
            // æ¬¡ã®è©¦è¡Œã¾ã§å°‘ã—å¾…ã¤
            await new Promise(resolve => setTimeout(resolve, 1000));
        }
    }
}</code></pre>
            </div>
        </section>

        <section id="parallel-processing">
            <h2>ä¸¦åˆ—å‡¦ç†</h2>
            
            <div class="example">
                <h3>é€æ¬¡å®Ÿè¡Œ vs ä¸¦åˆ—å®Ÿè¡Œ</h3>
                <pre><code>// APIã‚’æ¨¡æ“¬ã™ã‚‹é–¢æ•°
async function fetchData(name, delay) {
    await new Promise(resolve => setTimeout(resolve, delay));
    return `${name}ã®ãƒ‡ãƒ¼ã‚¿`;
}

// âŒ é€æ¬¡å®Ÿè¡Œï¼ˆé…ã„ï¼‰
async function sequentialFetch() {
    console.time('é€æ¬¡å®Ÿè¡Œ');
    
    const data1 = await fetchData('API1', 1000); // 1ç§’å¾…ã¤
    const data2 = await fetchData('API2', 1000); // ã•ã‚‰ã«1ç§’å¾…ã¤
    const data3 = await fetchData('API3', 1000); // ã•ã‚‰ã«1ç§’å¾…ã¤
    
    console.log([data1, data2, data3]);
    console.timeEnd('é€æ¬¡å®Ÿè¡Œ'); // ç´„3ç§’
}

// âœ… ä¸¦åˆ—å®Ÿè¡Œï¼ˆé€Ÿã„ï¼‰
async function parallelFetch() {
    console.time('ä¸¦åˆ—å®Ÿè¡Œ');
    
    const [data1, data2, data3] = await Promise.all([
        fetchData('API1', 1000),
        fetchData('API2', 1000),
        fetchData('API3', 1000)
    ]);
    
    console.log([data1, data2, data3]);
    console.timeEnd('ä¸¦åˆ—å®Ÿè¡Œ'); // ç´„1ç§’
}</code></pre>
                <button class="run-code" onclick="runParallelExample()">é€æ¬¡å®Ÿè¡Œã‚’è©¦ã™</button>
                <button class="run-code" onclick="runParallelExample2()">ä¸¦åˆ—å®Ÿè¡Œã‚’è©¦ã™</button>
                <div class="output" id="parallel-output"></div>
            </div>
        </section>

        <section id="practical-examples">
            <h2>å®Ÿè·µçš„ãªä¾‹</h2>
            
            <div class="example">
                <h3>å®Ÿç”¨ä¾‹1: APIãƒã‚§ãƒ¼ãƒ³</h3>
                <pre><code>// ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã¨æŠ•ç¨¿ã‚’å–å¾—ã™ã‚‹å®Ÿè·µçš„ãªä¾‹
async function getUserWithPosts(userId) {
    try {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
        const user = await fetch(`/api/users/${userId}`).then(r => r.json());
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŠ•ç¨¿ã‚’ä¸¦åˆ—ã§å–å¾—
        const [posts, profile] = await Promise.all([
            fetch(`/api/users/${userId}/posts`).then(r => r.json()),
            fetch(`/api/users/${userId}/profile`).then(r => r.json())
        ]);
        
        // ãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢
        return {
            ...user,
            profile,
            posts,
            postCount: posts.length
        };
        
    } catch (error) {
        console.error('ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        return null;
    }
}</code></pre>
            </div>

            <div class="example">
                <h3>å®Ÿç”¨ä¾‹2: ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†</h3>
                <pre><code>// è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†ã™ã‚‹ä¾‹
async function processFiles(files) {
    const results = [];
    
    for (const file of files) {
        try {
            console.log(`å‡¦ç†ä¸­: ${file.name}`);
            
            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
            const content = await readFile(file);
            
            // å†…å®¹ã‚’å‡¦ç†
            const processed = await processContent(content);
            
            // çµæœã‚’ä¿å­˜
            await saveResult(file.name, processed);
            
            results.push({
                file: file.name,
                status: 'success'
            });
            
        } catch (error) {
            results.push({
                file: file.name,
                status: 'error',
                error: error.message
            });
        }
    }
    
    return results;
}

// ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ï¼ˆæ¨¡æ“¬ï¼‰
async function readFile(file) {
    await delay(100);
    return `${file.name}ã®å†…å®¹`;
}

async function processContent(content) {
    await delay(200);
    return content.toUpperCase();
}

async function saveResult(filename, content) {
    await delay(100);
    console.log(`ä¿å­˜å®Œäº†: ${filename}`);
}</code></pre>
                <button class="run-code" onclick="runFileProcessingExample()">å®Ÿè¡Œã—ã¦ã¿ã‚‹</button>
                <div class="output" id="file-output"></div>
            </div>

            <div class="example">
                <h3>å®Ÿç”¨ä¾‹3: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡</h3>
                <div class="animation-demo">
                    <div id="animated-box" class="box">ğŸ“¦</div>
                    <button onclick="runAnimationExample()">ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹</button>
                </div>
                <pre><code>// ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é †ç•ªã«å®Ÿè¡Œ
async function runAnimation() {
    const box = document.getElementById('animated-box');
    
    // å³ã«ç§»å‹•
    await animateBox(box, 'right', 200);
    
    // ä¸‹ã«ç§»å‹•
    await animateBox(box, 'down', 100);
    
    // å·¦ã«ç§»å‹•
    await animateBox(box, 'left', 200);
    
    // ä¸Šã«ç§»å‹•
    await animateBox(box, 'up', 100);
    
    // å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    box.textContent = 'âœ…';
}

async function animateBox(element, direction, distance) {
    return new Promise(resolve => {
        element.style.transition = 'transform 0.5s ease';
        
        switch(direction) {
            case 'right':
                element.style.transform = `translateX(${distance}px)`;
                break;
            case 'down':
                element.style.transform += ` translateY(${distance}px)`;
                break;
            // ... ä»–ã®æ–¹å‘
        }
        
        setTimeout(resolve, 500);
    });
}</code></pre>
            </div>
        </section>

        <section id="best-practices">
            <h2>ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</h2>
            
            <div class="best-practice">
                <h3>1. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å¿˜ã‚Œãªã„</h3>
                <pre><code>// âŒ æ‚ªã„ä¾‹
async function badExample() {
    const data = await fetch('/api/data'); // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã‚‰ã‚¯ãƒ©ãƒƒã‚·ãƒ¥
}

// âœ… è‰¯ã„ä¾‹
async function goodExample() {
    try {
        const data = await fetch('/api/data');
        return data;
    } catch (error) {
        console.error('ã‚¨ãƒ©ãƒ¼:', error);
        return null; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¿”ã™
    }
}</code></pre>
            </div>

            <div class="best-practice">
                <h3>2. ä¸è¦ãª await ã‚’é¿ã‘ã‚‹</h3>
                <pre><code>// âŒ ä¸è¦ãª await
async function unnecessary() {
    return await fetch('/api/data'); // awaitã¯ä¸è¦
}

// âœ… ã‚·ãƒ³ãƒ—ãƒ«ã«
async function simple() {
    return fetch('/api/data');
}</code></pre>
            </div>

            <div class="best-practice">
                <h3>3. ä¸¦åˆ—å‡¦ç†ã‚’æ´»ç”¨ã™ã‚‹</h3>
                <pre><code>// âŒ é€æ¬¡å‡¦ç†ï¼ˆé…ã„ï¼‰
const user = await getUser();
const posts = await getPosts();
const comments = await getComments();

// âœ… ä¸¦åˆ—å‡¦ç†ï¼ˆé€Ÿã„ï¼‰
const [user, posts, comments] = await Promise.all([
    getUser(),
    getPosts(),
    getComments()
]);</code></pre>
            </div>
        </section>

        <section class="summary">
            <h2>ã¾ã¨ã‚</h2>
            <div class="key-points">
                <h3>async/awaitã®é‡è¦ãƒã‚¤ãƒ³ãƒˆ</h3>
                <ul>
                    <li>âœ… Promiseã‚’ã‚ˆã‚Šç›´æ„Ÿçš„ã«æ›¸ã‘ã‚‹</li>
                    <li>âœ… åŒæœŸçš„ãªã‚³ãƒ¼ãƒ‰ã®ã‚ˆã†ã«èª­ã¿ã‚„ã™ã„</li>
                    <li>âœ… try-catchã§ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒç°¡å˜</li>
                    <li>âœ… ãƒ‡ãƒãƒƒã‚°ãŒã—ã‚„ã™ã„</li>
                    <li>âœ… Promiseã¨å®Œå…¨ã«äº’æ›æ€§ãŒã‚ã‚‹</li>
                </ul>
            </div>
            
            <div class="next-steps">
                <h3>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h3>
                <p>éåŒæœŸå‡¦ç†ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ãŸã‚‰ã€é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ä¸–ç•Œã¸ï¼š</p>
                <a href="higher-order-functions.html" class="next-link">é«˜éšé–¢æ•° - é–¢æ•°ã‚’æ“ã‚‹é–¢æ•° â†’</a>
            </div>
        </section>
    </main>

    <footer>
        <p>async/awaitå®Œå…¨ã‚¬ã‚¤ãƒ‰ - ãƒ¢ãƒ€ãƒ³ãªéåŒæœŸå‡¦ç†ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã‚ˆã†ï¼</p>
    </footer>

    <script src="async-script.js"></script>
</body>
</html>